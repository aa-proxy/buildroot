BR2_riscv=y
BR2_TOOLCHAIN_EXTERNAL=y
BR2_TOOLCHAIN_EXTERNAL_CUSTOM=y
BR2_TOOLCHAIN_EXTERNAL_PATH="$(TOPDIR)/../host-tools/gcc/riscv64-linux-musl-x86_64"
BR2_TOOLCHAIN_EXTERNAL_CUSTOM_PREFIX="riscv64-unknown-linux-musl"
BR2_TOOLCHAIN_EXTERNAL_GCC_10=y
BR2_TOOLCHAIN_EXTERNAL_HEADERS_5_10=y
BR2_TOOLCHAIN_EXTERNAL_CUSTOM_MUSL=y
BR2_TOOLCHAIN_EXTERNAL_CXX=y
BR2_TOOLCHAIN_EXTERNAL_OPENMP=y

BR2_PACKAGE_BUSYBOX_CONFIG_FRAGMENT_FILES="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/board/radxa03w/busybox.fragment"
BR2_ROOTFS_OVERLAY="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/rootfs_overlay"
BR2_GLOBAL_PATCH_DIR="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/board/milkv-duos/patches"
BR2_ROOTFS_PRE_BUILD_SCRIPT="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/board/milkv-duos/pre-build.sh"
BR2_ROOTFS_POST_BUILD_SCRIPT="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/board/milkv-duos/post-build.sh"
BR2_ROOTFS_POST_IMAGE_SCRIPT="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/board/milkv-duos/post-image.sh"

# Kernel config
BR2_LINUX_KERNEL=y
BR2_LINUX_KERNEL_CUSTOM_GIT=y
BR2_LINUX_KERNEL_CUSTOM_REPO_URL="https://github.com/sophgo/linux_5.10.git"
BR2_LINUX_KERNEL_CUSTOM_REPO_VERSION="88685c05097808fb6bf559c70a44a4d69f6e7034"
BR2_LINUX_KERNEL_USE_DEFCONFIG=n
BR2_LINUX_KERNEL_USE_CUSTOM_CONFIG=y
BR2_LINUX_KERNEL_CUSTOM_CONFIG_FILE="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/board/milkv-duos/kernel.config"

# Build the DTB from the kernel sources
BR2_PACKAGE_HOST_DTC=y
BR2_LINUX_KERNEL_DTS_SUPPORT=y
BR2_LINUX_KERNEL_CUSTOM_DTS_DIR="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/board/milkv-duos/dts"
BR2_LINUX_KERNEL_INTREE_DTS_NAME="cvitek/sg2000_milkv_duos_musl_riscv64_sd"

# Sophgo's U-Boot
BR2_TARGET_UBOOT=y
BR2_TARGET_UBOOT_BUILD_SYSTEM_KCONFIG=y
BR2_TARGET_UBOOT_CUSTOM_GIT=y
BR2_TARGET_UBOOT_CUSTOM_REPO_URL="https://github.com/sophgo/u-boot-2021.10"
BR2_TARGET_UBOOT_CUSTOM_REPO_VERSION="71a772fb2b32bb3a4ed0fe762266023e0aa21c1e"
BR2_TARGET_UBOOT_USE_CUSTOM_CONFIG=y
BR2_TARGET_UBOOT_CUSTOM_CONFIG_FILE="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/board/milkv-duos/u-boot/cvitek_sg2000_milkv_duos_musl_riscv64_sd_defconfig"
BR2_TARGET_UBOOT_NEEDS_OPENSBI=y
BR2_TARGET_UBOOT_NEEDS_DTC=y
BR2_TARGET_UBOOT_CUSTOM_DTS_PATH="$(BR2_EXTERNAL_AA_PROXY_OS_PATH)/board/milkv-duos/dts/cvitek/*dts*"
BR2_TARGET_UBOOT_CUSTOM_MAKEOPTS="CHIP=sg2000 CVIBOARD=milkv_duos_musl_riscv64_sd CONFIG_USE_DEFAULT_ENV=y CONFIG_SKIP_RAMDISK=y STORAGE_TYPE=sd"
BR2_TARGET_UBOOT_FORMAT_DTB=y

# OpenSBI
BR2_TARGET_OPENSBI=y
BR2_TARGET_OPENSBI_PLAT="generic"
BR2_TARGET_OPENSBI_CUSTOM_GIT=y
BR2_TARGET_OPENSBI_CUSTOM_REPO_URL="https://github.com/sophgo/opensbi"
BR2_TARGET_OPENSBI_CUSTOM_REPO_VERSION="6766e9cc96df51cde91540f9a15f291bf843b682"
BR2_TARGET_OPENSBI_UBOOT_PAYLOAD=y
BR2_TARGET_OPENSBI_FW_FDT_PATH=y
BR2_TARGET_OPENSBI_ADDITIONAL_VARIABLES="CHIP_ARCH=CV181X PM_SRAM_BIN_PATH=/app/buildroot/output/milkv-duos/build/opensbi-6766e9cc96df51cde91540f9a15f291bf843b682/pm_default_cv181x.bin"

BR2_TARGET_LDFLAGS="-march=rv64imafdcv0p7xthead -mcpu=c906fdv -mabi=lp64d -mcmodel=medany"
BR2_OPTIMIZE_S=y
BR2_TARGET_GENERIC_HOSTNAME="milkv-duo"
BR2_TARGET_GENERIC_ISSUE="Welcome to Milk-V DuoS RISCV64 SD"
BR2_TARGET_GENERIC_ROOT_PASSWD="milkv"
BR2_TARGET_ROOTFS_EXT2=y
BR2_TARGET_ROOTFS_EXT2_4=y
BR2_TARGET_ROOTFS_EXT2_SIZE="786432K"
BR2_PACKAGE_HOST_GENIMAGE=y
BR2_PACKAGE_HOST_DOSFSTOOLS=y
BR2_PACKAGE_HOST_MTOOLS=y

BR2_RISCV_ISA_RVC=y
BR2_PACKAGE_FREERTOS=y
